<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Referrer Leaderboard - Aruna Talent</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23f96dcc'/><text x='50' y='68' font-family='Arial' font-size='45' font-weight='bold' fill='white' text-anchor='middle'>A</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/theme.css">
    <style>
        .container { max-width: 1000px; margin: 0 auto; padding: 48px 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .logo { width: 160px; margin-bottom: 24px; }
        .header h1 {
            font-size: 32px; font-weight: 800; margin-bottom: 12px;
        }
        .header p { font-size: 16px; line-height: 1.6; }

        /* Stats Grid */
        .stats-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 16px; margin-bottom: 40px;
        }

        /* Personal Stats Banner */
        .personal-banner {
            display: none; background: rgba(20, 20, 23, 0.6);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px; padding: 32px; margin-bottom: 32px; color: white;
        }
        .personal-banner.active { display: block; }
        .personal-header { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
        .personal-rank {
            width: 56px; height: 56px; border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-pink) 0%, #d44fa0 100%);
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: 700;
        }
        .personal-name { font-size: 24px; font-weight: 700; }
        .personal-tier { font-size: 14px; color: var(--accent-pink); font-weight: 600; }
        .personal-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        .personal-stat { background: rgba(255,255,255,0.06); border-radius: 12px; padding: 16px; text-align: center; }
        .personal-stat-value { font-size: 24px; font-weight: 700; color: var(--accent-pink); }
        .personal-stat-label { font-size: 11px; color: var(--text-secondary); margin-top: 4px; text-transform: uppercase; }

        /* Leaderboard */
        .leaderboard {
            background: rgba(20, 20, 23, 0.6); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px; overflow: hidden; margin-bottom: 40px;
        }
        .leaderboard-header-bar {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px 24px; color: white;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }
        .leaderboard-title { font-size: 18px; font-weight: 700; }
        .leaderboard-subtitle { font-size: 13px; color: var(--text-muted); }
        .leaderboard-table { width: 100%; }
        .leaderboard-table-header {
            display: grid; grid-template-columns: 60px 1fr 100px 100px 120px 100px 100px;
            padding: 14px 24px; font-size: 11px; font-weight: 600; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.03);
        }
        .leaderboard-row {
            display: grid; grid-template-columns: 60px 1fr 100px 100px 120px 100px 100px;
            padding: 16px 24px; align-items: center; border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            transition: all 0.2s ease;
        }
        .leaderboard-row:hover { background: rgba(249, 109, 204, 0.05); }
        .leaderboard-row.highlighted { background: rgba(249, 109, 204, 0.08); border-left: 4px solid var(--accent-pink); }
        .leaderboard-row:last-child { border-bottom: none; }

        .rank {
            width: 36px; height: 36px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-weight: 700; font-size: 14px;
        }
        .rank-1 { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; }
        .rank-2 { background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%); color: white; }
        .rank-3 { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
        .rank-other { background: rgba(255, 255, 255, 0.06); color: var(--text-muted); }

        .referrer-info { display: flex; align-items: center; gap: 12px; }
        .referrer-avatar {
            width: 40px; height: 40px; border-radius: 50%;
            background: rgba(249, 109, 204, 0.08);
            display: flex; align-items: center; justify-content: center; font-size: 18px;
        }
        .referrer-name { font-weight: 600; font-size: 14px; color: var(--text-primary); }
        .referrer-tier { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .tier-base { color: var(--text-muted); }
        .tier-gold { color: #f59e0b; }
        .tier-diamond { color: var(--accent-pink); }

        .stat-cell { font-size: 14px; font-weight: 600; color: var(--text-secondary); text-align: center; }
        .stat-cell.highlight { color: #10b981; }
        .stat-cell.earnings { color: var(--accent-pink); font-weight: 700; }

        /* Tier Cards */
        .tiers-section { margin-bottom: 40px; }
        .tiers-header { text-align: center; margin-bottom: 24px; }
        .tiers-title { font-size: 24px; font-weight: 800; margin-bottom: 8px; }
        .tiers-subtitle { font-size: 14px; color: var(--text-secondary); }

        .tier-cards-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;
        }
        .tier-card-item {
            border-radius: 16px; padding: 24px; text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .tier-card-item:hover { transform: translateY(-4px); }

        .tier-card-base {
            background: linear-gradient(180deg, rgba(100, 116, 139, 0.1) 0%, rgba(20, 20, 23, 0.6) 100%);
            border: 2px solid rgba(100, 116, 139, 0.2);
        }
        .tier-card-base:hover { box-shadow: 0 12px 32px rgba(100, 116, 139, 0.12), 0 4px 12px rgba(0, 0, 0, 0.3); border-color: rgba(100, 116, 139, 0.35); }

        .tier-card-gold {
            background: linear-gradient(180deg, rgba(245, 158, 11, 0.12) 0%, rgba(20, 20, 23, 0.6) 100%);
            border: 2px solid rgba(245, 158, 11, 0.35);
        }
        .tier-card-gold:hover { box-shadow: 0 12px 32px rgba(245, 158, 11, 0.15), 0 4px 12px rgba(0, 0, 0, 0.3); border-color: rgba(245, 158, 11, 0.55); }

        .tier-card-diamond {
            background: linear-gradient(180deg, rgba(249, 109, 204, 0.12) 0%, rgba(20, 20, 23, 0.6) 100%);
            border: 2px solid rgba(249, 109, 204, 0.35);
        }
        .tier-card-diamond:hover { box-shadow: 0 12px 32px rgba(249, 109, 204, 0.18), 0 4px 12px rgba(0, 0, 0, 0.3); border-color: rgba(249, 109, 204, 0.55); }

        .tier-label-badge {
            display: inline-block; font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1.5px; padding: 4px 12px; border-radius: 6px;
        }
        .badge-base { background: rgba(100, 116, 139, 0.15); color: #94a3b8; border: 1px solid rgba(100, 116, 139, 0.25); }
        .badge-gold { background: rgba(245, 158, 11, 0.15); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.3); }
        .badge-diamond { background: rgba(249, 109, 204, 0.15); color: var(--accent-pink); border: 1px solid rgba(249, 109, 204, 0.3); }

        .commission-header-rates {
            display: flex; justify-content: center; align-items: center;
            gap: 32px; flex-wrap: wrap;
        }
        .commission-rate-box { text-align: center; }
        .commission-rate {
            font-size: 64px; font-weight: 800; line-height: 1;
            background: linear-gradient(135deg, var(--accent-pink) 0%, #ff8fd4 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .commission-arrow { font-size: 24px; color: var(--text-muted); }

        /* Path to Earnings */
        .path-section {
            background: rgba(20, 20, 23, 0.6); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px; padding: 40px; color: white; text-align: center; margin-bottom: 40px;
        }
        .path-title { font-size: 28px; font-weight: 800; margin-bottom: 12px; }
        .path-subtitle { font-size: 16px; color: var(--text-secondary); margin-bottom: 32px; }

        /* Filter Selects */
        .leaderboard-filters { display: flex; gap: 12px; }
        .filter-select {
            padding: 8px 16px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12);
            border-radius: 8px; color: white; font-size: 13px; font-weight: 500;
            cursor: pointer; appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23999999'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: right 8px center; background-size: 16px;
            padding-right: 32px;
        }
        .filter-select:focus { outline: none; border-color: var(--accent-pink); }
        .filter-select option { background: var(--dark-3); color: white; }

        @media (max-width: 900px) {
            .leaderboard-filters { flex-wrap: wrap; }
            .filter-select { font-size: 12px; padding: 6px 12px; padding-right: 28px; }
            .leaderboard-header-bar { flex-direction: column; gap: 16px; align-items: flex-start; }
            .leaderboard-table-header, .leaderboard-row {
                grid-template-columns: 50px 1fr 80px 80px;
            }
            .leaderboard-table-header > *:nth-child(5),
            .leaderboard-table-header > *:nth-child(6),
            .leaderboard-table-header > *:nth-child(7),
            .leaderboard-row > *:nth-child(5),
            .leaderboard-row > *:nth-child(6),
            .leaderboard-row > *:nth-child(7) { display: none; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .personal-stats { grid-template-columns: repeat(2, 1fr); }
            .earning-paths-grid { grid-template-columns: repeat(2, 1fr) !important; }
            .tier-cards-grid { grid-template-columns: 1fr !important; }
            .commission-header-rates {
                flex-direction: column;
                gap: 16px;
            }
            .commission-rate {
                font-size: 48px;
            }
            .commission-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body class="noise-bg">
    <div class="container">
        <div class="header">
            <img src="logo.png" alt="Aruna Talent" class="logo">
            <h1 class="gradient-text">Referrer Leaderboard</h1>
            <p class="text-secondary">Top performers ranked by revenue generated. Climb the tiers, earn more.</p>
        </div>

        <!-- Personal Stats (shown when ?referrer=Name) -->
        <div class="personal-banner" id="personalBanner">
            <div class="personal-header">
                <div class="personal-rank" id="personalRank">#-</div>
                <div>
                    <div class="personal-name" id="personalName">Your Stats</div>
                    <div class="personal-tier" id="personalTier">Base Tier</div>
                </div>
            </div>
            <div class="personal-stats">
                <div class="personal-stat">
                    <div class="personal-stat-value" id="personalRevenue">$0</div>
                    <div class="personal-stat-label">Monthly Revenue</div>
                </div>
                <div class="personal-stat">
                    <div class="personal-stat-value" id="personalModels">0</div>
                    <div class="personal-stat-label">Active Models</div>
                </div>
                <div class="personal-stat">
                    <div class="personal-stat-value" id="personalRetention">0 mo</div>
                    <div class="personal-stat-label">Avg Retention</div>
                </div>
                <div class="personal-stat">
                    <div class="personal-stat-value" id="personalEarnings">$0</div>
                    <div class="personal-stat-label">Your Earnings</div>
                </div>
            </div>
        </div>

        <!-- Overall Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalModels">--</div>
                <div class="stat-label">Active Models</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgEarnings">--</div>
                <div class="stat-label">Avg Model Earnings</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgRetention">--</div>
                <div class="stat-label">Avg Retention</div>
                <div style="color: #10b981; font-size: 10px; margin-top: 4px;">Industry: 4 mo</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalReferrers">--</div>
                <div class="stat-label">Active Referrers</div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard">
            <div class="leaderboard-header-bar">
                <div>
                    <div class="leaderboard-title">Rankings</div>
                    <div class="leaderboard-subtitle">Sorted by <span id="sortByLabel">monthly revenue</span></div>
                </div>
                <div class="leaderboard-filters">
                    <select id="sortSelect" class="filter-select" onchange="sortLeaderboard()">
                        <option value="revenue">Revenue</option>
                        <option value="models">Models</option>
                        <option value="retention">Retention</option>
                        <option value="earnings">Earnings</option>
                    </select>
                    <select id="tierFilter" class="filter-select" onchange="filterLeaderboard()">
                        <option value="all">All Tiers</option>
                        <option value="diamond">Diamond Only</option>
                        <option value="gold">Gold Only</option>
                        <option value="base">Base Only</option>
                    </select>
                </div>
            </div>
            <div class="leaderboard-table-header">
                <div>Rank</div>
                <div>Referrer</div>
                <div style="text-align: center;">Models</div>
                <div style="text-align: center;">Avg Retention</div>
                <div style="text-align: center;">Avg/Model</div>
                <div style="text-align: center;">Revenue</div>
                <div style="text-align: center;">Earnings</div>
            </div>
            <div id="leaderboardBody">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Commission Section -->
        <div style="border-radius: 24px; overflow: hidden; margin-bottom: 40px; box-shadow: 0 8px 40px rgba(249, 109, 204, 0.1), 0 4px 20px rgba(0, 0, 0, 0.4); border: 1px solid rgba(249, 109, 204, 0.12);">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #16161a 0%, #1a1a22 100%); padding: 40px 32px; text-align: center; color: white; border-bottom: 1px solid rgba(249, 109, 204, 0.15);">
                <div style="font-size: 12px; font-weight: 600; color: var(--accent-pink); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px;">Your Commission</div>
                <div class="commission-header-rates">
                    <div class="commission-rate-box">
                        <div class="commission-rate">5%</div>
                        <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">Each creator's first 3 months</div>
                    </div>
                    <div class="commission-arrow">‚Üí</div>
                    <div class="commission-rate-box">
                        <div class="commission-rate">2.5-3%</div>
                        <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">Lifetime (based on your tier)</div>
                    </div>
                </div>
                <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.06); font-size: 14px; color: var(--text-muted);">
                    Paid monthly ¬∑ No cap on earnings<br>Higher volume = higher rate
                </div>
            </div>

            <!-- Tier Cards -->
            <div style="padding: 32px; background: rgba(255, 255, 255, 0.015);">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div style="font-size: 18px; font-weight: 700; color: var(--text-primary);">Lifetime Tier Structure</div>
                    <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Based on total monthly revenue from your referrals</div>
                </div>
                <div class="tier-cards-grid">
                    <!-- Base -->
                    <div class="tier-card-item tier-card-base">
                        <div style="font-size: 36px; margin-bottom: 12px;">ü•â</div>
                        <div class="tier-label-badge badge-base">Base</div>
                        <div style="font-size: 40px; font-weight: 800; color: var(--accent-pink); margin: 12px 0 8px;">2.5%</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">&lt; $500K revenue</div>
                    </div>
                    <!-- Gold -->
                    <div class="tier-card-item tier-card-gold">
                        <div style="font-size: 36px; margin-bottom: 12px;">ü•á</div>
                        <div class="tier-label-badge badge-gold">Gold</div>
                        <div style="font-size: 40px; font-weight: 800; color: var(--accent-pink); margin: 12px 0 8px;">2.75%</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">$500K - $2M revenue</div>
                    </div>
                    <!-- Diamond -->
                    <div class="tier-card-item tier-card-diamond">
                        <div style="font-size: 36px; margin-bottom: 12px;">üíé</div>
                        <div class="tier-label-badge badge-diamond">Diamond</div>
                        <div style="font-size: 40px; font-weight: 800; color: var(--accent-pink); margin: 12px 0 8px;">3%</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">$2M+ revenue</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Earning Paths -->
        <div class="path-section">
            <div class="path-title">Your Path to Earnings</div>
            <div class="path-subtitle">Here's exactly what it takes at each level</div>
            <div class="earning-paths-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-top: 32px;">
                <!-- $10K Path -->
                <div style="background: rgba(255,255,255,0.06); border-radius: 16px; padding: 20px; text-align: center;">
                    <div style="font-size: 28px; font-weight: 800; color: var(--accent-pink); margin-bottom: 4px;">$10K</div>
                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px;">Per Month</div>
                    <div style="background: rgba(255,255,255,0.06); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                        <div style="font-size: 18px; font-weight: 700;">$400K</div>
                        <div style="font-size: 10px; color: var(--text-muted);">Monthly Revenue</div>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Base ¬∑ 2.5%</div>
                </div>
                <!-- $25K Path -->
                <div style="background: rgba(255,255,255,0.06); border-radius: 16px; padding: 20px; text-align: center; border: 1px solid rgba(249, 109, 204, 0.15);">
                    <div style="font-size: 28px; font-weight: 800; color: var(--accent-pink); margin-bottom: 4px;">$25K</div>
                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px;">Per Month</div>
                    <div style="background: rgba(255,255,255,0.06); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                        <div style="font-size: 18px; font-weight: 700;">$910K</div>
                        <div style="font-size: 10px; color: var(--text-muted);">Monthly Revenue</div>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Gold ¬∑ 2.75%</div>
                </div>
                <!-- $50K Path -->
                <div style="background: rgba(255,255,255,0.08); border-radius: 16px; padding: 20px; text-align: center; border: 1px solid rgba(249, 109, 204, 0.2);">
                    <div style="font-size: 28px; font-weight: 800; color: var(--accent-pink); margin-bottom: 4px;">$50K</div>
                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px;">Per Month</div>
                    <div style="background: rgba(255,255,255,0.06); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                        <div style="font-size: 18px; font-weight: 700;">$1.82M</div>
                        <div style="font-size: 10px; color: var(--text-muted);">Monthly Revenue</div>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Gold ¬∑ 2.75%</div>
                </div>
                <!-- $100K Path -->
                <div style="background: linear-gradient(135deg, rgba(249,109,204,0.15) 0%, rgba(249,109,204,0.08) 100%); border-radius: 16px; padding: 20px; text-align: center; border: 2px solid var(--accent-pink);">
                    <div style="font-size: 28px; font-weight: 800; color: white; margin-bottom: 4px;">$100K</div>
                    <div style="font-size: 11px; color: var(--accent-pink); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px;">Per Month</div>
                    <div style="background: rgba(255,255,255,0.06); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                        <div style="font-size: 18px; font-weight: 700;">$3.33M</div>
                        <div style="font-size: 10px; color: var(--text-muted);">Monthly Revenue</div>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Diamond ¬∑ 3%</div>
                </div>
            </div>
        </div>

        <div class="site-footer">
            <p>Want to join? <a href="/">Become a referrer</a></p>
            <p style="margin-top: 8px;"><a href="/dashboard">‚Üê Back to Dashboard</a></p>
        </div>
    </div>

    <script>
        // Google Sheets Integration
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQChUrjw5PJusQ4yKWy7jfiA8Hgs-pX12kGDPxNhRS0wZfdNewbVB8BuT4JRxfenIvqZ5jza1SGJe1K/pub?gid=2139152553&single=true&output=csv';

        const sampleData = [
            { name: 'Sarah M.', emoji: 'üëë', models: 24, retention: 14, avgPerModel: 103847.29, revenue: 2492334.96, code: 'SARAH123' },
            { name: 'James K.', emoji: '‚≠ê', models: 14, retention: 11, avgPerModel: 64891.34, revenue: 908478.76, code: 'JAMES456' },
            { name: 'Alex R.', emoji: 'üî•', models: 8, retention: 9, avgPerModel: 44123.67, revenue: 352989.36, code: 'ALEX789' },
            { name: 'Morgan L.', emoji: '‚ú®', models: 6, retention: 8, avgPerModel: 41892.54, revenue: 251355.24 },
            { name: 'Casey P.', emoji: 'üí´', models: 5, retention: 10, avgPerModel: 36478.92, revenue: 182394.60 },
            { name: 'Riley W.', emoji: 'üåü', models: 4, retention: 7, avgPerModel: 33217.85, revenue: 132871.40 },
            { name: 'Jordan B.', emoji: 'üíñ', models: 3, retention: 6, avgPerModel: 27834.19, revenue: 83502.57 },
            { name: 'Chris D.', emoji: 'ü¶ã', models: 2, retention: 5, avgPerModel: 23156.78, revenue: 46313.56 },
        ];

        function getTier(revenue) {
            if (revenue >= 2000000) return { name: 'Diamond', rate: 3, class: 'tier-diamond' };
            if (revenue >= 500000) return { name: 'Gold', rate: 2.75, class: 'tier-gold' };
            return { name: 'Base', rate: 2.5, class: 'tier-base' };
        }

        function formatCurrency(amount, abbreviated = false) {
            if (abbreviated) {
                if (amount >= 1000000) return '$' + (amount / 1000000).toFixed(2) + 'M';
                if (amount >= 1000) return '$' + (amount / 1000).toFixed(0) + 'K';
            }
            return '$' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        const params = new URLSearchParams(window.location.search);
        const referrerParam = params.get('referrer');

        async function loadData() {
            let data = sampleData;

            if (SHEET_URL) {
                try {
                    const response = await fetch(SHEET_URL);
                    const csv = await response.text();
                    const rows = csv.split('\n').slice(1);
                    data = rows.map(row => {
                        const cols = row.split(',');
                        return {
                            name: cols[0],
                            emoji: cols[1],
                            models: parseInt(cols[2]) || 0,
                            retention: parseInt(cols[3]) || 0,
                            avgPerModel: parseInt(cols[4]) || 0,
                            revenue: parseInt(cols[5]) || 0,
                            code: cols[6]?.trim() || ''
                        };
                    }).filter(d => d.name);
                } catch (e) {
                    console.log('Using sample data');
                }
            }

            currentData = data;

            const totalModels = data.reduce((sum, r) => sum + r.models, 0);
            const totalRevenue = data.reduce((sum, r) => sum + r.revenue, 0);
            const avgRetention = Math.round(data.reduce((sum, r) => sum + r.retention, 0) / data.length);
            const avgEarningsPerModel = Math.round(totalRevenue / totalModels);

            document.getElementById('totalModels').textContent = totalModels;
            document.getElementById('avgEarnings').textContent = formatCurrency(avgEarningsPerModel);
            document.getElementById('avgRetention').textContent = avgRetention + ' mo';
            document.getElementById('totalReferrers').textContent = data.length;

            renderLeaderboard();
        }

        let currentData = [];
        let currentSort = 'revenue';
        let currentFilter = 'all';

        function sortLeaderboard() {
            currentSort = document.getElementById('sortSelect').value;
            const labels = { revenue: 'monthly revenue', models: 'number of models', retention: 'average retention', earnings: 'total earnings' };
            document.getElementById('sortByLabel').textContent = labels[currentSort];
            renderLeaderboard();
        }

        function filterLeaderboard() {
            currentFilter = document.getElementById('tierFilter').value;
            renderLeaderboard();
        }

        function renderLeaderboard() {
            let data = [...currentData];

            if (currentFilter !== 'all') {
                data = data.filter(r => {
                    const tier = getTier(r.revenue).name.toLowerCase();
                    return tier === currentFilter;
                });
            }

            data.sort((a, b) => {
                switch(currentSort) {
                    case 'models': return b.models - a.models;
                    case 'retention': return b.retention - a.retention;
                    case 'earnings': return (b.revenue * getTier(b.revenue).rate) - (a.revenue * getTier(a.revenue).rate);
                    default: return b.revenue - a.revenue;
                }
            });

            const leaderboardBody = document.getElementById('leaderboardBody');
            leaderboardBody.innerHTML = '';

            data.forEach((referrer, index) => {
                const rank = index + 1;
                const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
                const tier = getTier(referrer.revenue);
                const earnings = referrer.revenue * (tier.rate / 100);
                const isHighlighted = referrerParam && referrer.name.toLowerCase().includes(referrerParam.toLowerCase());

                const row = document.createElement('div');
                row.className = 'leaderboard-row' + (isHighlighted ? ' highlighted' : '');
                const nameLink = referrer.code ? `<a href="/my-referrals?code=${referrer.code}" style="color: inherit; text-decoration: none;">${referrer.name}</a>` : referrer.name;
                row.innerHTML = `
                    <div class="rank ${rankClass}">${rank}</div>
                    <div class="referrer-info">
                        <div class="referrer-avatar">${referrer.emoji}</div>
                        <div>
                            <div class="referrer-name">${nameLink}</div>
                            <div class="referrer-tier ${tier.class}">${tier.name} ¬∑ ${tier.rate}%</div>
                        </div>
                    </div>
                    <div class="stat-cell">${referrer.models}</div>
                    <div class="stat-cell highlight">${referrer.retention} mo</div>
                    <div class="stat-cell">${formatCurrency(referrer.avgPerModel, true)}</div>
                    <div class="stat-cell">${formatCurrency(referrer.revenue)}</div>
                    <div class="stat-cell earnings">${formatCurrency(earnings)}</div>
                `;
                leaderboardBody.appendChild(row);

                if (isHighlighted) {
                    document.getElementById('personalBanner').classList.add('active');
                    document.getElementById('personalRank').textContent = '#' + rank;
                    document.getElementById('personalName').textContent = referrer.name;
                    document.getElementById('personalTier').textContent = tier.name + ' Tier ¬∑ ' + tier.rate + '%';
                    document.getElementById('personalRevenue').textContent = formatCurrency(referrer.revenue);
                    document.getElementById('personalModels').textContent = referrer.models;
                    document.getElementById('personalRetention').textContent = referrer.retention + ' mo';
                    document.getElementById('personalEarnings').textContent = formatCurrency(earnings);
                }
            });
        }

        loadData();
    </script>
</body>
</html>
